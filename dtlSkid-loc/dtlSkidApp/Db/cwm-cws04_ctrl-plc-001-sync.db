# DTL plcFactory data synchronization
# Lock system to prevent unauthrized sync loops
#
# The CODE used by DTL Skid application is:
# - PLC side:
# 	* State 0,1: 0xFFFF FFFF FFFF FF00 (-256)
# 	* State 2,3: 0xFFFF FFFF FFFF FF11 (-239)
# 	* State 4:   0xFFFF FFFF FFFF FF22 (-222)
# 	* State 5:   0xFFFF FFFF FFFF FF33 (-205)
# 	* State 6:   0xFFFF FFFF FFFF FF44 (-188)
# - EPICS side:
# 	* Condition 1 (_ACK):  0xFFFF FFFF FFFF DD22
# 	* Condition 2 (_DONE): 0xFFFF FFFF FFFF DD33
#
# Developed by Maurizio Montis | INFN-LNL
# mail: maurizio.montis@lnl.infn.it
#
# Changelog:
# V1.0:
#      - initial setup
#  

record(calcout, "CWM-CWS04:Ctrl-Intf-001:EPICSSyncLck")
{
	field(DESC, "PV sync lock system") 
	field(SCAN, ".1 second")
	field(INPA, "CWM-CWS04:Ctrl-Intf-001:PLCCommMsg")
	#field(INPB, "CWM-CWS04:Ctrl-Intf-001:EPICSCommMsg")
	field(CALC, "(A=-188)?1:0")

}


record(ao, "CWM-CWS04:Ctrl-Intf-001:EPICSExecSync") {
	field(DESC, "Execute Syncronization")
	field(OMSL, "supervisory")
	field(PINI, "YES")
	field(VAL, "0")
	#field(OUT, "CWM-CWS04:WtrC-YSV-001:MovTim-Sync.PROC CP")
	#field(OUT, "CWM-CWS04:WtrC-CIT-001:Ilck-NotEnb-Sync.PROC CP")
	field(FLNK, "CWM-CWS04:Ctrl-Intf-001:EPICSSyncFout")
}

record(dfanout, "CWM-CWS04:Ctrl-Intf-001:EPICSSyncFout") {
	field(DESC, "Dfanout Syncronization")
	field(OMSL, "closed_loop")
	field(DOL, "CWM-CWS04:Ctrl-Intf-001:EPICSExecSync")
	## to check for any software update
	field(OUTA, "CWM-CWS04:WtrC-EH-001:FBL-RevOp-Sync.PROC")
	field(OUTB, "CWM-CWS04:WtrC-TCV-001:NOTyp-Sync.PROC")
	field(OUTC, "CWM-CWS04:WtrC-YSV-001:Enb-Sync.PROC")
	field(OUTD, "CWM-CWS04:WtrC-TCV-001:Pos-Def-Sync.PROC")
	field(OUTE, "CWM-CWS04:WtrC-Y-001:Freq-Def-Sync.PROC")
	field(OUTF, "CWM-CWS04:WtrC-YSV-001:MovTim-Sync.PROC")
	field(OUTG, "")
	field(OUTH, "")
}
